generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String   @id
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  name            String
  email           String
  phone           String?
  activityId      String
  activityTitle   String
  date            DateTime
  guests          Int
  totalPrice      Float
  pickupLocation  String?
  flightNumber    String?
  language        String?
  dietary         String?
  specialRequests String?
  packageName     String?
  status          String    @default("PENDING")
  paymentStatus   String    @default("UNPAID") // UNPAID, PAID, REFUNDED
  invoiceUrl      String?
  userId          String?
  user            User?     @relation(fields: [userId], references: [id])
  payments        Payment[]
  review          Review?
}

model Payment {
  id        String   @id @default(uuid())
  amount    Float
  currency  String   @default("EUR")
  status    String   @default("PENDING") // PENDING, COMPLETED, FAILED
  method    String?  // CREDIT_CARD, PAYPAL, CASH
  createdAt DateTime @default(now())
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id])
}

model NewsletterSubscriber {
  id        String   @id @default(uuid())
  email     String   @unique
  createdAt DateTime @default(now())
  active    Boolean  @default(true)
}

model User {
  id                 String         @id @default(uuid())
  email              String         @unique
  password           String
  name               String?
  phone              String?
  role               String         @default("CLIENT")
  canMessage         Boolean        @default(true)
  conversationStatus String         @default("NONE")
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  bookings           Booking[]
  conversations      Conversation[]
  messages           Message[]
  notifications      Notification[]
  reviews            Review[]
  loyaltyPoints      Int            @default(0)
  wishlist           String[]       @default([])
}

model Conversation {
  id        String    @id @default(uuid())
  subject   String
  status    String    @default("OPEN")
  userId    String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id])
  messages  Message[]
}

model Message {
  id             String       @id @default(uuid())
  content        String
  sender         String
  read           Boolean      @default(false)
  conversationId String
  userId         String
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO") // INFO, SUCCESS, WARNING, ERROR, BOOKING
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  link      String?
  user      User     @relation(fields: [userId], references: [id])
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  serviceId String
  userId    String
  bookingId String   @unique
  booking   Booking  @relation(fields: [bookingId], references: [id])
  service   Service  @relation(fields: [serviceId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Service {
  id          String   @id @default(uuid())
  title       String
  description String
  price       Float
  images      String
  category    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  rating      Float    @default(0)
  reviews     Int      @default(0)
  duration    String   @default("")
  location    String   @default("")
  latitude    Float?
  longitude   Float?
  features    String
  included    String
  whatToBring String
  itinerary   String
  host        String
  tags        String
  userReviews Review[]
}

model SupportRequest {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
