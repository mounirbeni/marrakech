{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mouni/Desktop/marrakech/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient()\r\n}\r\n\r\ndeclare global {\r\n    var prisma: undefined | ReturnType<typeof prismaClientSingleton>\r\n}\r\n\r\nconst prisma = globalThis.prisma ?? prismaClientSingleton()\r\n\r\nexport default prisma\r\n\r\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY;AAC3B;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mouni/Desktop/marrakech/src/app/api/bookings/route.ts"],"sourcesContent":["\r\nimport { NextResponse } from 'next/server';\r\nimport prisma from '@/lib/prisma';\r\nimport { Booking } from '@prisma/client';\r\n\r\n// Helper to generate short readable IDs (e.g., \"BK-X7Y2Z\")\r\nfunction generateBookingId() {\r\n    const chars = '23456789ABCDEFGHJKLMNPQRSTUVWXYZ'; // Removed confusing chars (0, O, 1, I)\r\n    let result = '';\r\n    for (let i = 0; i < 6; i++) {\r\n        result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return result; // Result: \"X7Y2Z9\"\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // Basic Validation\r\n        if (!body.contact?.name || !body.contact?.email || !body.activityId || !body.date) {\r\n            return NextResponse.json(\r\n                { error: 'Missing required fields' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const booking = await prisma.booking.create({\r\n            data: {\r\n                id: generateBookingId(),\r\n                name: body.contact.name,\r\n                email: body.contact.email,\r\n                phone: body.contact.phone,\r\n                activityId: body.activityId,\r\n                activityTitle: body.activityTitle,\r\n                date: new Date(body.date),\r\n                guests: body.guests,\r\n                totalPrice: body.totalPrice,\r\n                packageName: body.package,\r\n\r\n                pickupLocation: body.logistics.pickupLocation,\r\n                flightNumber: body.logistics.flightNumber,\r\n\r\n                language: body.preferences.language,\r\n                dietary: body.preferences.dietary,\r\n                specialRequests: body.preferences.specialRequests,\r\n\r\n                status: 'PENDING'\r\n            }\r\n        });\r\n\r\n        return NextResponse.json(booking, { status: 201 });\r\n\r\n    } catch (error) {\r\n        console.error('Booking Error:', error);\r\n        return NextResponse.json(\r\n            {\r\n                error: 'Internal Server Error',\r\n                details: error instanceof Error ? error.message : String(error)\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\nexport async function GET(request: Request) {\r\n    try {\r\n        // Auto-update past bookings to COMPLETED\r\n        await prisma.booking.updateMany({\r\n            where: {\r\n                status: 'CONFIRMED',\r\n                date: {\r\n                    lt: new Date()\r\n                }\r\n            },\r\n            data: {\r\n                status: 'COMPLETED'\r\n            }\r\n        });\r\n\r\n        // In a real app, you would verify admin session here\r\n        const bookings = await prisma.booking.findMany({\r\n            orderBy: {\r\n                createdAt: 'desc'\r\n            }\r\n        });\r\n\r\n        return NextResponse.json(bookings);\r\n    } catch (error) {\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch bookings' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;AACA;;;AAGA,2DAA2D;AAC3D,SAAS;IACL,MAAM,QAAQ,oCAAoC,uCAAuC;IACzF,IAAI,SAAS;IACb,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;QACxB,UAAU,MAAM,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM;IAClE;IACA,OAAO,QAAQ,mBAAmB;AACtC;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,mBAAmB;QACnB,IAAI,CAAC,KAAK,OAAO,EAAE,QAAQ,CAAC,KAAK,OAAO,EAAE,SAAS,CAAC,KAAK,UAAU,IAAI,CAAC,KAAK,IAAI,EAAE;YAC/E,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,UAAU,MAAM,iIAAM,CAAC,OAAO,CAAC,MAAM,CAAC;YACxC,MAAM;gBACF,IAAI;gBACJ,MAAM,KAAK,OAAO,CAAC,IAAI;gBACvB,OAAO,KAAK,OAAO,CAAC,KAAK;gBACzB,OAAO,KAAK,OAAO,CAAC,KAAK;gBACzB,YAAY,KAAK,UAAU;gBAC3B,eAAe,KAAK,aAAa;gBACjC,MAAM,IAAI,KAAK,KAAK,IAAI;gBACxB,QAAQ,KAAK,MAAM;gBACnB,YAAY,KAAK,UAAU;gBAC3B,aAAa,KAAK,OAAO;gBAEzB,gBAAgB,KAAK,SAAS,CAAC,cAAc;gBAC7C,cAAc,KAAK,SAAS,CAAC,YAAY;gBAEzC,UAAU,KAAK,WAAW,CAAC,QAAQ;gBACnC,SAAS,KAAK,WAAW,CAAC,OAAO;gBACjC,iBAAiB,KAAK,WAAW,CAAC,eAAe;gBAEjD,QAAQ;YACZ;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;YAAE,QAAQ;QAAI;IAEpD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAC7D,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ;AAEO,eAAe,IAAI,OAAgB;IACtC,IAAI;QACA,yCAAyC;QACzC,MAAM,iIAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAC5B,OAAO;gBACH,QAAQ;gBACR,MAAM;oBACF,IAAI,IAAI;gBACZ;YACJ;YACA,MAAM;gBACF,QAAQ;YACZ;QACJ;QAEA,qDAAqD;QACrD,MAAM,WAAW,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAC3C,SAAS;gBACL,WAAW;YACf;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}