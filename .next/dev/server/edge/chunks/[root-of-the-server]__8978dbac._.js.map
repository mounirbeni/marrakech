{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\nimport { jwtVerify } from 'jose'\r\n\r\nconst JWT_SECRET = new TextEncoder().encode(\r\n    process.env.JWT_SECRET || 'default-secret-key-change-this'\r\n);\r\n\r\nasync function getUserFromToken(token: string) {\r\n    try {\r\n        const { payload } = await jwtVerify(token, JWT_SECRET);\r\n        return payload as { id: string; email: string; role: string };\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function middleware(request: NextRequest) {\r\n    const { pathname } = request.nextUrl;\r\n\r\n    // Get auth token from cookies\r\n    const token = request.cookies.get('auth_token')?.value;\r\n    const user = token ? await getUserFromToken(token) : null;\r\n    const isAuthenticated = !!user;\r\n\r\n    // Protected routes\r\n    const isDashboardRoute = pathname.startsWith('/dashboard');\r\n    const isAdminRoute = pathname.startsWith('/admin');\r\n    const isProfileRoute = pathname.startsWith('/profile');\r\n    const isProtectedRoute = isDashboardRoute || isAdminRoute || isProfileRoute;\r\n\r\n    // Public auth routes\r\n    const isLoginRoute = pathname.startsWith('/login');\r\n    const isRegisterRoute = pathname.startsWith('/register');\r\n\r\n    // Redirect unauthenticated users to login\r\n    if (isProtectedRoute && !isAuthenticated) {\r\n        const loginUrl = new URL('/login', request.url);\r\n        loginUrl.searchParams.set('from', pathname);\r\n        return NextResponse.redirect(loginUrl);\r\n    }\r\n\r\n    // Check admin role for admin routes\r\n    if (isAdminRoute && isAuthenticated && user?.role !== 'ADMIN') {\r\n        return NextResponse.redirect(new URL('/dashboard', request.url));\r\n    }\r\n\r\n    // Redirect authenticated users away from login/register\r\n    if ((isLoginRoute || isRegisterRoute) && isAuthenticated) {\r\n        if (user?.role === 'ADMIN') {\r\n            return NextResponse.redirect(new URL('/admin/dashboard', request.url));\r\n        } else {\r\n            return NextResponse.redirect(new URL('/dashboard', request.url));\r\n        }\r\n    }\r\n\r\n    return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n    matcher: [\r\n        '/dashboard/:path*',\r\n        '/admin/:path*',\r\n        '/profile/:path*',\r\n        '/login',\r\n        '/register'\r\n    ],\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CACvC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAG9B,eAAe,iBAAiB,KAAa;IACzC,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4KAAS,EAAC,OAAO;QAC3C,OAAO;IACX,EAAE,OAAM;QACJ,OAAO;IACX;AACJ;AAEO,eAAe,WAAW,OAAoB;IACjD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,8BAA8B;IAC9B,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IACjD,MAAM,OAAO,QAAQ,MAAM,iBAAiB,SAAS;IACrD,MAAM,kBAAkB,CAAC,CAAC;IAE1B,mBAAmB;IACnB,MAAM,mBAAmB,SAAS,UAAU,CAAC;IAC7C,MAAM,eAAe,SAAS,UAAU,CAAC;IACzC,MAAM,iBAAiB,SAAS,UAAU,CAAC;IAC3C,MAAM,mBAAmB,oBAAoB,gBAAgB;IAE7D,qBAAqB;IACrB,MAAM,eAAe,SAAS,UAAU,CAAC;IACzC,MAAM,kBAAkB,SAAS,UAAU,CAAC;IAE5C,0CAA0C;IAC1C,IAAI,oBAAoB,CAAC,iBAAiB;QACtC,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ;QAClC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,oCAAoC;IACpC,IAAI,gBAAgB,mBAAmB,MAAM,SAAS,SAAS;QAC3D,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAClE;IAEA,wDAAwD;IACxD,IAAI,CAAC,gBAAgB,eAAe,KAAK,iBAAiB;QACtD,IAAI,MAAM,SAAS,SAAS;YACxB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,oBAAoB,QAAQ,GAAG;QACxE,OAAO;YACH,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;QAClE;IACJ;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC5B;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;QACA;QACA;QACA;QACA;KACH;AACL"}}]
}