// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id              String   @id
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  name            String
  email           String
  phone           String?
  
  activityId      String
  activityTitle   String
  date            DateTime
  guests          Int
  totalPrice      Float
  
  pickupLocation  String?
  flightNumber    String?
  language        String?
  dietary         String?
  specialRequests String?
  packageName     String?

  status          String   @default("PENDING") // PENDING, CONFIRMED, CANCELLED
  
  user            User?    @relation(fields: [userId], references: [id])
  userId          String?
  review          Review?
}

model NewsletterSubscriber {
  id        String   @id @default(uuid())
  email     String   @unique
  createdAt DateTime @default(now())
  active    Boolean  @default(true)
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("CLIENT") // CLIENT, ADMIN
  canMessage Boolean  @default(true)
  conversationStatus String @default("NONE") // NONE, PENDING, OPEN, CLOSED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  bookings  Booking[]
  messages  Message[]
  reviews   Review[]
  conversations Conversation[]
}

model Conversation {
  id        String   @id @default(uuid())
  subject   String
  status    String   @default("OPEN") // OPEN, CLOSED
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  messages  Message[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Message {
  id             String   @id @default(uuid())
  content        String
  sender         String   // USER or ADMIN
  read           Boolean  @default(false)
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  createdAt      DateTime @default(now())
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  
  service   Service  @relation(fields: [serviceId], references: [id])
  serviceId String
  
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  
  booking   Booking  @relation(fields: [bookingId], references: [id])
  bookingId String   @unique
}

model Service {
  id          String   @id @default(uuid())
  title       String
  description String
  price       Float
  images      String // Stores JSON string of image URLs
  category    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // New fields for rich content
  rating      Float    @default(0)
  reviews     Int      @default(0)
  duration    String   @default("")
  location    String   @default("")
  features    String
  included    String
  whatToBring String
  itinerary   String  // JSON string
  host        String  // JSON string
  tags        String
  
  userReviews Review[]
}

model SupportRequest {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  status    String   @default("PENDING") // PENDING, IN_PROGRESS, RESOLVED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
