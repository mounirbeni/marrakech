{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mouni/Desktop/marrakech/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient()\r\n}\r\n\r\ndeclare global {\r\n    var prisma: undefined | ReturnType<typeof prismaClientSingleton>\r\n}\r\n\r\nconst prisma = globalThis.prisma ?? prismaClientSingleton()\r\n\r\nexport default prisma\r\n\r\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY;AAC3B;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mouni/Desktop/marrakech/src/lib/admin-logic.ts"],"sourcesContent":["import prisma from '@/lib/prisma';\r\nimport { Booking } from '@prisma/client';\r\n\r\nexport interface AdminStats {\r\n    revenueToday: number;\r\n    bookingsToday: number;\r\n    activeUsers: number; // Mocked for now\r\n    conversionRate: number; // Mocked for now\r\n}\r\n\r\nexport interface AdminAlert {\r\n    id: string;\r\n    type: 'CRITICAL' | 'WARNING' | 'INFO';\r\n    title: string;\r\n    time: string; // Relative time string for UI\r\n    action: string;\r\n    rawDate: Date;\r\n}\r\n\r\nexport interface TopService {\r\n    id: string;\r\n    title: string;\r\n    bookingsCount: number;\r\n    revenue: number;\r\n    rating: number;\r\n}\r\n\r\nexport interface UrgentStats {\r\n    pendingBookings: number;\r\n    pendingSupport: number;\r\n    pendingReviews: number;\r\n}\r\n\r\nexport async function getAdminStats(): Promise<AdminStats> {\r\n    const now = new Date();\r\n    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n    // Revenue Today\r\n    const bookingsToday = await prisma.booking.findMany({\r\n        where: {\r\n            createdAt: { gte: startOfDay },\r\n            status: 'CONFIRMED'\r\n        }\r\n    });\r\n\r\n    const revenueToday = bookingsToday.reduce((acc: number, b: Booking) => acc + (b.totalPrice || 0), 0);\r\n\r\n    return {\r\n        revenueToday,\r\n        bookingsToday: bookingsToday.length,\r\n        activeUsers: 42, // Mock\r\n        conversionRate: 3.2, // Mock\r\n    };\r\n}\r\n\r\nexport async function getAdminAlerts(): Promise<AdminAlert[]> {\r\n    // 1. Unconfirmed bookings > 24h\r\n    const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000);\r\n    const unconfirmed = await prisma.booking.findMany({\r\n        where: {\r\n            status: 'PENDING',\r\n            createdAt: { lt: yesterday }\r\n        }\r\n    });\r\n\r\n    const alerts: AdminAlert[] = [];\r\n\r\n    unconfirmed.forEach((b: Booking) => {\r\n        alerts.push({\r\n            id: `booking-${b.id}`,\r\n            type: 'WARNING',\r\n            title: `Unconfirmed Booking: ${b.name}`,\r\n            time: '24h+',\r\n            action: 'Review',\r\n            rawDate: b.createdAt\r\n        });\r\n    });\r\n\r\n    // 2. Mock some critical alerts for demo\r\n    alerts.push({\r\n        id: 'mock-1',\r\n        type: 'CRITICAL',\r\n        title: 'Payment Failed: Booking #B-998',\r\n        time: '12m ago',\r\n        action: 'Retry',\r\n        rawDate: new Date(Date.now() - 12 * 60 * 1000)\r\n    });\r\n\r\n    return alerts.sort((a, b) => b.rawDate.getTime() - a.rawDate.getTime());\r\n}\r\n\r\nexport async function getUrgentStats(): Promise<UrgentStats> {\r\n    const pendingBookings = await prisma.booking.count({\r\n        where: { status: 'PENDING' }\r\n    });\r\n\r\n    const pendingSupport = await prisma.supportRequest.count({\r\n        where: { status: 'PENDING' }\r\n    });\r\n\r\n    // Assuming Review has some status or just recent ones, but schema has no status for Review.\r\n    // We'll mimic this by checking reviews in the last 24h or just return 0 for now as 'Moderation Pending'\r\n    // Actually schema has no status for review. Let's ignore or use a placeholder.\r\n    const pendingReviews = 0;\r\n\r\n    return {\r\n        pendingBookings,\r\n        pendingSupport,\r\n        pendingReviews\r\n    };\r\n}\r\n\r\nexport async function getTopServices(): Promise<TopService[]> {\r\n    // 1. Group bookings by activityId\r\n    const bookings = await prisma.booking.findMany({\r\n        where: { status: 'CONFIRMED' },\r\n        select: { activityId: true, activityTitle: true, totalPrice: true }\r\n    });\r\n\r\n    const serviceStats: Record<string, TopService> = {};\r\n\r\n    bookings.forEach(b => {\r\n        if (!serviceStats[b.activityId]) {\r\n            serviceStats[b.activityId] = {\r\n                id: b.activityId,\r\n                title: b.activityTitle,\r\n                bookingsCount: 0,\r\n                revenue: 0,\r\n                rating: 4.8 // Mock rating for now as we don't have easy access to Service table relation here yet\r\n            };\r\n        }\r\n        serviceStats[b.activityId].bookingsCount += 1;\r\n        serviceStats[b.activityId].revenue += (b.totalPrice || 0);\r\n    });\r\n\r\n    return Object.values(serviceStats)\r\n        .sort((a, b) => b.bookingsCount - a.bookingsCount)\r\n        .slice(0, 5);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAiCO,eAAe;IAClB,MAAM,MAAM,IAAI;IAChB,MAAM,aAAa,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI,IAAI,OAAO;IAE1E,gBAAgB;IAChB,MAAM,gBAAgB,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QAChD,OAAO;YACH,WAAW;gBAAE,KAAK;YAAW;YAC7B,QAAQ;QACZ;IACJ;IAEA,MAAM,eAAe,cAAc,MAAM,CAAC,CAAC,KAAa,IAAe,MAAM,CAAC,EAAE,UAAU,IAAI,CAAC,GAAG;IAElG,OAAO;QACH;QACA,eAAe,cAAc,MAAM;QACnC,aAAa;QACb,gBAAgB;IACpB;AACJ;AAEO,eAAe;IAClB,gCAAgC;IAChC,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;IACvD,MAAM,cAAc,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QAC9C,OAAO;YACH,QAAQ;YACR,WAAW;gBAAE,IAAI;YAAU;QAC/B;IACJ;IAEA,MAAM,SAAuB,EAAE;IAE/B,YAAY,OAAO,CAAC,CAAC;QACjB,OAAO,IAAI,CAAC;YACR,IAAI,CAAC,QAAQ,EAAE,EAAE,EAAE,EAAE;YACrB,MAAM;YACN,OAAO,CAAC,qBAAqB,EAAE,EAAE,IAAI,EAAE;YACvC,MAAM;YACN,QAAQ;YACR,SAAS,EAAE,SAAS;QACxB;IACJ;IAEA,wCAAwC;IACxC,OAAO,IAAI,CAAC;QACR,IAAI;QACJ,MAAM;QACN,OAAO;QACP,MAAM;QACN,QAAQ;QACR,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK;IAC7C;IAEA,OAAO,OAAO,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,OAAO,CAAC,OAAO,KAAK,EAAE,OAAO,CAAC,OAAO;AACxE;AAEO,eAAe;IAClB,MAAM,kBAAkB,MAAM,iIAAM,CAAC,OAAO,CAAC,KAAK,CAAC;QAC/C,OAAO;YAAE,QAAQ;QAAU;IAC/B;IAEA,MAAM,iBAAiB,MAAM,iIAAM,CAAC,cAAc,CAAC,KAAK,CAAC;QACrD,OAAO;YAAE,QAAQ;QAAU;IAC/B;IAEA,4FAA4F;IAC5F,wGAAwG;IACxG,+EAA+E;IAC/E,MAAM,iBAAiB;IAEvB,OAAO;QACH;QACA;QACA;IACJ;AACJ;AAEO,eAAe;IAClB,kCAAkC;IAClC,MAAM,WAAW,MAAM,iIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QAC3C,OAAO;YAAE,QAAQ;QAAY;QAC7B,QAAQ;YAAE,YAAY;YAAM,eAAe;YAAM,YAAY;QAAK;IACtE;IAEA,MAAM,eAA2C,CAAC;IAElD,SAAS,OAAO,CAAC,CAAA;QACb,IAAI,CAAC,YAAY,CAAC,EAAE,UAAU,CAAC,EAAE;YAC7B,YAAY,CAAC,EAAE,UAAU,CAAC,GAAG;gBACzB,IAAI,EAAE,UAAU;gBAChB,OAAO,EAAE,aAAa;gBACtB,eAAe;gBACf,SAAS;gBACT,QAAQ,IAAI,sFAAsF;YACtG;QACJ;QACA,YAAY,CAAC,EAAE,UAAU,CAAC,CAAC,aAAa,IAAI;QAC5C,YAAY,CAAC,EAAE,UAAU,CAAC,CAAC,OAAO,IAAK,EAAE,UAAU,IAAI;IAC3D;IAEA,OAAO,OAAO,MAAM,CAAC,cAChB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,aAAa,GAAG,EAAE,aAAa,EAChD,KAAK,CAAC,GAAG;AAClB"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mouni/Desktop/marrakech/src/app/api/admin/dashboard/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { getAdminStats, getAdminAlerts, getUrgentStats, getTopServices } from '@/lib/admin-logic';\r\n\r\nexport async function GET() {\r\n    try {\r\n        // TODO: Admin Auth Check\r\n\r\n        const [stats, alerts, urgentStats, topServices] = await Promise.all([\r\n            getAdminStats(),\r\n            getAdminAlerts(),\r\n            getUrgentStats(),\r\n            getTopServices()\r\n        ]);\r\n\r\n        return NextResponse.json({\r\n            stats,\r\n            alerts,\r\n            urgentStats,\r\n            topServices\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Admin API Error:', error);\r\n        return new NextResponse('Internal Server Error', { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,yBAAyB;QAEzB,MAAM,CAAC,OAAO,QAAQ,aAAa,YAAY,GAAG,MAAM,QAAQ,GAAG,CAAC;YAChE,IAAA,+IAAa;YACb,IAAA,gJAAc;YACd,IAAA,gJAAc;YACd,IAAA,gJAAc;SACjB;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB;YACA;YACA;YACA;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,gJAAY,CAAC,yBAAyB;YAAE,QAAQ;QAAI;IACnE;AACJ"}}]
}