module.exports=[91119,a=>{"use strict";var b=a.i(87924),c=a.i(68114);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f])},96221,a=>{"use strict";let b=(0,a.i(70106).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},16201,a=>{"use strict";let b=(0,a.i(70106).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],16201)},92759,a=>{"use strict";let b=(0,a.i(70106).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],92759)},81560,a=>{"use strict";let b=(0,a.i(70106).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);a.s(["Trash2",()=>b],81560)},62722,a=>{"use strict";let b=(0,a.i(70106).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],62722)},87280,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(56711),f=a.i(23292),g=a.i(99570),h=a.i(91119),i=a.i(66718),j=a.i(86304),k=a.i(96221),l=a.i(92759),m=a.i(21601);let n=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var o=a.i(62722),p=a.i(81560),q=a.i(16201),r=a.i(68114);function s(){let a=(0,d.useRouter)(),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!1);(0,c.useEffect)(()=>{fetch("/api/auth/me").then(a=>a.json()).then(b=>{b.user&&"ADMIN"===b.user.role?E():a.push("/admin")})},[a]),(0,c.useEffect)(()=>{if(u){let a=setInterval(()=>{F(u.id),E()},3e3);return()=>clearInterval(a)}},[u]);let E=async()=>{try{let a=await fetch("/api/admin/conversations");if(a.ok){let b=await a.json();t(b)}}catch(a){console.error(a)}finally{B(!1)}},F=async a=>{try{let b=await fetch(`/api/admin/messages/${a}`);b.ok&&x(await b.json())}catch(a){console.error(a)}},G=async()=>{if(u&&confirm("Close this conversation? The user will no longer be able to send messages to this ticket."))try{let a=await fetch(`/api/admin/conversations/${u.id}/close`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close"})});if(a.ok)f.toast.success("Conversation closed"),E(),F(u.id);else{let b=await a.json();console.error("Close error:",b),f.toast.error(b.details||b.error||"Failed to close conversation")}}catch(a){console.error("Close exception:",a),f.toast.error("Failed to close conversation")}},H=async()=>{if(u&&confirm("Reopen this conversation? The user will be able to send messages again."))try{let a=await fetch(`/api/admin/conversations/${u.id}/close`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reopen"})});if(a.ok)f.toast.success("Conversation reopened"),E(),F(u.id);else{let b=await a.json();f.toast.error(b.details||b.error||"Failed to reopen conversation")}}catch(a){f.toast.error("Failed to reopen conversation")}},I=async()=>{if(u&&confirm("Delete this entire conversation? This action cannot be undone."))try{(await fetch(`/api/admin/conversations/${u.userId}`,{method:"DELETE"})).ok?(f.toast.success("Conversation deleted"),v(null),E()):f.toast.error("Failed to delete conversation")}catch(a){f.toast.error("Failed to delete conversation")}},J=async a=>{if(a.preventDefault(),y.trim()&&u){D(!0);try{let a=await fetch(`/api/admin/messages/${u.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:y})});if(a.ok){let b=await a.json();x([...w,b]),z("")}else f.toast.error("Failed to send message")}finally{D(!1)}}};return A?(0,b.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,b.jsx)(k.Loader2,{className:"animate-spin"})}):(0,b.jsxs)("div",{className:"container mx-auto p-6",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center gap-4",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"icon",onClick:()=>a.push("/admin"),children:(0,b.jsx)(n,{className:"w-4 h-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Support Messages"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Respond to client inquiries"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[(0,b.jsxs)(h.Card,{className:"md:col-span-1 overflow-hidden flex flex-col",children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"text-lg",children:["Conversations (",s.length,")"]})}),(0,b.jsx)(h.CardContent,{className:"flex-1 overflow-y-auto p-0",children:0===s.length?(0,b.jsxs)("div",{className:"p-6 text-center text-muted-foreground",children:[(0,b.jsx)(m.MessageSquare,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No conversations yet"})]}):s.map(a=>(0,b.jsxs)("button",{onClick:()=>{v(a),F(a.id)},className:(0,r.cn)("w-full p-4 border-b text-left transition-colors hover:bg-secondary",u?.id===a.id&&"bg-secondary"),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.subject}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.userName})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 items-end",children:[a.unreadCount>0&&(0,b.jsx)(j.Badge,{className:"bg-primary text-xs",children:a.unreadCount}),(0,b.jsx)(j.Badge,{variant:"OPEN"===a.status?"default":"secondary",className:"text-xs",children:a.status})]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1 truncate",children:a.lastMessage}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:(0,e.format)(new Date(a.lastMessageTime),"PPp")})]},a.id))})]}),(0,b.jsx)(h.Card,{className:"md:col-span-2 flex flex-col overflow-hidden",children:u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.CardHeader,{className:"border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-lg",children:u.subject}),(0,b.jsx)(j.Badge,{variant:"OPEN"===u.status?"default":"secondary",children:u.status})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[u.userName," (",u.userEmail,")"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:["OPEN"===u.status?(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:G,className:"gap-1",children:[(0,b.jsx)(o.XCircle,{className:"w-4 h-4"}),"Close"]}):(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:H,className:"gap-1",children:[(0,b.jsx)(q.CheckCircle,{className:"w-4 h-4"}),"Reopen"]}),(0,b.jsxs)(g.Button,{variant:"destructive",size:"sm",onClick:I,className:"gap-1",children:[(0,b.jsx)(p.Trash2,{className:"w-4 h-4"}),"Delete"]})]})]})}),(0,b.jsx)(h.CardContent,{className:"flex-1 overflow-y-auto p-4 space-y-4",children:w.map(a=>(0,b.jsx)("div",{className:`flex ${"ADMIN"===a.sender?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:(0,r.cn)("max-w-[80%] rounded-lg p-3","ADMIN"===a.sender?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.content}),(0,b.jsx)("span",{className:"text-[10px] opacity-70 block mt-1",children:(0,e.format)(new Date(a.createdAt),"p")})]})},a.id))}),(0,b.jsx)("div",{className:"p-4 border-t",children:(0,b.jsxs)("form",{onSubmit:J,className:"flex gap-2",children:[(0,b.jsx)(i.Input,{value:y,onChange:a=>z(a.target.value),placeholder:"Type your response...",disabled:C}),(0,b.jsx)(g.Button,{type:"submit",disabled:C||!y.trim(),children:C?(0,b.jsx)(k.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(l.Send,{className:"w-4 h-4"})})]})})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(m.MessageSquare,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"Select a conversation to start messaging"})]})})})]})]})}a.s(["default",()=>s],87280)}];

//# sourceMappingURL=_9d0fba3f._.js.map